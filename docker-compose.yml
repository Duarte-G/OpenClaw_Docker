services:
  openclaw-sandbox:
    # Nota: Verifique a tag oficial mais recente no DockerHub/GHCR
    image: ghcr.io/openclaw/openclaw:latest 
    ports:
      # SEGURANÇA: Garante que só o seu PC (localhost) acesse o painel, bloqueando a rede externa/wifi.
      - "127.0.0.1:18789:18789"
    container_name: openclaw_sandbox
    restart: unless-stopped
    
    # SEGURANÇA: Usuário Não-Root
    user: "1000:1000"

    # SEGURANÇA: Isolamento de Rede
    network_mode: bridge

    # Comando de inicialização forçando o bind na interface LAN (necessário para Docker)
    command: node openclaw.mjs gateway --allow-unconfigured --bind lan --port 18789

    environment:
      - NODE_ENV=production
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      # Força o diretório de trabalho para a pasta isolada
      - WORKDIR=/app/workspace
      - OPENCLAW_GATEWAY_TOKEN=${OPENCLAW_GATEWAY_TOKEN}

    volumes:
      # Coloque os arquivos nesta pasta para o agente poder acessar.
      # Mapeia a pasta local './workspace' para dentro do container.
      - ./workspace:/app/workspace:rw

      # Config e Dados (Persistência)
      - ./config:/app/config:rw
      - openclaw_data:/app/data:rw

    # Limite de Recursos (Evita que o agente trave seu PC em loop infinito)
    deploy:
      resources:
        limits:
          cpus: '2.0' # Limite de CPU (2 núcleos)
          memory: 6G # 6Gb de memória RAM

volumes:
  openclaw_data: